<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-173606225-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-173606225-1');
    </script>
    <meta charset="utf-8">
    <meta name="theme-color" content="#222127">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>web-call.cc</title>
    <script src="custom-elements/custom-elements.min.js"></script>
    <link href="css/gui.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="widgets/split-pane-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/tab-controller-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/tab-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/button-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/icon-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/text-input-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/accordion-pane-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/toolbar-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/dialog-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/calendar-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/title-pane-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/text-area-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/slider-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/label-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/checkbox-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/select-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/progress-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/radio-6.0.0.css"/>
    <link rel="stylesheet" href="widgets/time-picker-6.0.0.css"/>
    <link rel="stylesheet" href="themes/dojo/dojo-6.0.0.css">
    <style>
      html,
      body {
	  margin: 0;
	  padding: 0;
	  width: 100%;
	  height: 100%;
	  font-family: arial;
      }

      body {
	  display: flex;
	  flex-direction: column;
      }

      .split-pane-holder {
	  flex: 1;
	  overflow: hidden;
      }

      .ce-layout {
	  margin: 5px;
	  display: inline-block;
      }

      .vertical-slider {
	  margin-left: 20px;
	  display: inline-block;
      }
    </style>
    <style>
      .split-pane-holder { flex: 1; overflow: hidden; }
      .ce-layout { margin: 5px; display: inline-block; }
      .vertical-slider { margin-left: 20px; display: inline-block; }
    </style>
    <style>
      .vblock {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 8em;
	height: 4em;
        margin: 0.2em;
	background-color: rgba(0, 255, 255, 0.0);
	border: 0.1em solid rgba(0, 0, 0, 0.4);
      }
      h1 h2 {
        margin-top: 0.2em;
        margin-bottom: 0.2em;
      }
    </style>
    <script>
      var biwa;
      window.onload = function() {
	  var onError = function(e){ console.error(e); }
	  biwa = new BiwaScheme.Interpreter(onError);
	  biwa.evaluate('(load "in-browser-gui.scm")\
                         (js-call% "makeDraggable" (getelem1 "#canvas"))\
                         (reset (test))',
			function(result) {
			    console.log('BiwaScheme and prototype DOM editor fully loaded.');
			});
	  notDraggable = $("#block7")[0];
	  makeDraggable = function (node) {
	      var treeWalker = document.createTreeWalker(node, NodeFilter.SHOW_ELEMENT, {
		  acceptNode: function (node) {
		      return NodeFilter.FILTER_ACCEPT;
		  }
	      }, false);
	      console.log("TreeWalker created.");
	      do {
		  //console.log(treeWalker.currentNode);
		  // Text selections, images, and links have an OS-dependent default rendering
		  // of them being dragged. If we want that default behavior, we should not
		  // set the "draggable" attribute of them.
		  treeWalker.currentNode.draggable = "true";
	      } while (treeWalker.nextNode());
	  }
	  //biwa.evaluate('(js-call (js-eval "makeDraggable") (getelem1 "#canvas"))', function(result) { console.log(result); });
      };
      isCustomElement = function(element) {
	  // Look for a hyphen in the tag name
	  return element.parentElement.outerHTML.split(" ")[0].indexOf("-") >= 0;
      }
    </script>
  </head>
  <body>
    <script src="themes/dojo/dojo-6.0.0.js"></script>
    <!-- Apply typography and color theme modules globally from `vaadin-lumo-styles` -->
    <custom-style>
      <style include="lumo-typography lumo-color"></style>
    </custom-style>
    <vaadin-app-layout>
      <vaadin-drawer-toggle slot="navbar"></vaadin-drawer-toggle>
      <img slot="navbar" src="images/zen.png" alt="Zen Logo" width="32" height="32" referrerpolicy="no-referrer">
      <vaadin-tabs slot="drawer" orientation="vertical" theme="minimal" style="margin: 0 auto; flex: 1;">
	<vaadin-tab>
	  <iron-icon icon="vaadin:home"></iron-icon>
	  Demo #1
	</vaadin-tab>
	<vaadin-tab>
	  <iron-icon icon="vaadin:list"></iron-icon>
	  <a href="index2.html">Other experimental code</a>
	</vaadin-tab>
      </vaadin-tabs>

      <div class="content">
	<h1 style="margin-top:0.2em; margin-bottom:0.5em;">web-call.cc demo #1</h1>
	<h2 style="margin:0.2em 0em 0em 0em;">Alpha prototype of the <a href="https://doc.mashweb.club/">Zen</a> live DOM editor</h2>.
	<vaadin-details id="definitions">
	  <div slot="summary"><span id="defstate"></span></div>

	  <dl>
	    <dt><i><b>What is a DOM?</b></i></dt> <dd>When a web page is loaded, the browser creates a Document Object
	      Model (DOM) of the page. The DOM is basically just a tree of text objects
	      and <em>element</em> objects
	      like DIVs (divisions of the page), paragraphs, headers, articles, sections,
	      blockquotes, links, lists, interactive components (like buttons and forms),
	      and many more. The DOM defines the structure of the page by defining
	      which of the page's elements are inside, i.e. <em>nested within,</em>
	      which other page elements.</dd>
	    <dt><i><b>What is a live DOM editor?</b></i></dt> <dd>A live DOM editor is a program or
	      application in a web page that changes the relative positions,
              and possibly attributes and properties, of DOM elements <i>on the fly</i>,
              that is, without requiring the page to be refreshed or updated from the web server.
              A useful live DOM editor should also probably be able to add and delete DOM elements.
	      A useful DOM editor will likely be able to persist these changes
	      by saving them locally or on the web server.</dd>
	    <dt><i><b>What is the alpha prototype of the Zen live DOM editor?</b></i></dt> <dd>This page,
	      containing the alpha prototype of the Zen live DOM editor, is a demonstration of a
	      <a href="http://localhost/dev/my-repos-on-github/web-call.cc/in-browser-gui.scm">
	      very clear and simple way</a> to program a complex GUI
	      (graphical user interface). Being an alpha prototype, it still has bugs
	      and does not yet work in Explorer or mobile browsers. In case you do
	      not find the operation of this DOM editor to be obvious, there are
	      instructions at the bottom of the page.</dd>
	  </dl>
	</vaadin-details>
	<script>
	  customElements.whenDefined('vaadin-details').then(function() {
	    const details = document.querySelector('#definitions');

	    // listen for details state change
	    details.addEventListener('opened-changed', function(e) {
	      document.getElementById('defstate').textContent = e.detail.value ? 'Hide definitions' : 'Show definitions';
	    });

	    // set the state programmatically
	    details.opened = true;
	  });
	</script>

        <hr style="background-color:black;"/>

        <div style="max-width:560px; margin: 2em 5em 0 4em; padding: 0.5em; border:1px solid black;">
	  <div id="message"></div>
	  <div id="error"></div>
	  <div id="tools">
	    <button id="add" class="ghosted">Add-insert</button>
	    <button id="copyx" style="background-color:lightgreen">Copy-insert</button>
	    <button id="copy-before" style="background-color:lightgreen">Copy-before</button>
	    <button id="paste" class="ghosted">Paste-insert</button>
	    <button id="move" style="background-color:lightgreen">Move-insert</button>
	    <button id="move-before" style="background-color:lightgreen">Move-before</button>
	    <button id="delete" class="ghosted">Delete</button>
	    <button id="undo" class="ghosted">Undo</button>
	    <button id="redo" class="ghosted">Redo</button>
	    <button id="save" class="ghosted">Save</button>
	  </div>
        </div>

	<div id="canvas" style="max-width:720px; overflow: auto;">
	  <div class="ex" id="block1">Block 1
	    <div class="ex" id="block1a">Block1a</div>
	    <div class="ex" id="block1b">Block1b</div>
	  </div>
	  <div class="ex inline" id="inline1">Inline 1</div>
	  <div class="ex inline" id="inline2">Inline 2</div>
	  <div class="ex inline" id="inline3">Inline 3
	    <div class="ex inline" id="inline3a">Inline 3a</div>
	  </div>
	  <div class="ex" id="block2">Block 2
	    <div class="ex inline" id="inline2a">Inline 2a</div>
	    <div class="ex inline" id="inline2b">Inline 2b</div>
	  </div>
	  <div class="ex" id="block3">Block 3</div>
          <div class="ex">A <a href="https://vaadin.com/components/vaadin-list-box">Vaadin List Box</a>
            <hr/>
	    <vaadin-list-box selected="0">
	      <vaadin-item class="vblock">Option one</vaadin-item>
	      <vaadin-item class="vblock">Option two</vaadin-item>
	      <vaadin-item class="vblock">Option three</vaadin-item>
	    </vaadin-list-box>
          </div>
          <div class="ex">A <a href="https://vaadin.com/components/vaadin-ordered-layout">Vaadin Ordered Layout</a>, Horizontal
            <hr/>
	    <vaadin-horizontal-layout>
	      <div class="vblock">Item 1</div>
	      <div class="vblock">Item 2</div>
	      <div class="vblock">Item 3</div>
	    </vaadin-horizontal-layout>
          </div>
          <div class="ex">A <a href="https://vaadin.com/components/vaadin-ordered-layout">Vaadin Ordered Layout</a>, Vertical
            <hr/>
	    <vaadin-vertical-layout>
	      <div class="vblock">Item A</div>
	      <div class="vblock">Item B</div>
	      <div class="vblock">Item C</div>
	    </vaadin-vertical-layout>
          </div>
	  <dojo-button id="db1" class="ce-layout">Basic Dojo Button</dojo-button>
	  <dojo-button class="ce-layout">Dojo Icon Button <dojo-icon type="searchIcon"></dojo-icon></dojo-button>
	  <dojo-button class="ce-layout" id="dojoEnabledPopupButton">Dojo Popup</dojo-button>
	  <dojo-button class="ce-layout" id="dojoEnabledToggleButton">Dojo Toggle</dojo-button>
	  <dojo-button class="ce-layout" id="dojoDisabledBasicButton">Disabled Basic Dojo Button</dojo-button>
	  <dojo-button class="ce-layout" id="dojoDisabledIconButton">Disabled Dojo Icon Button <dojo-icon type="searchIcon"></dojo-icon></dojo-button>
	  <dojo-button class="ce-layout" id="dojoDisabledPopupButton">Disabled Dojo Popup</dojo-button>
	  <dojo-button class="ce-layout" id="dojoDisabledToggleButton">Disabled Dojo Toggle</dojo-button>
	  <dojo-checkbox class="ce-layout ce-block" id="dojoCheckedCheckbox" label="Checked checkbox"></dojo-checkbox>
	  <dojo-checkbox class="ce-layout ce-block" id="dojoDisabledCheckedCheckbox" label="Disabled checked checkbox"></dojo-checkbox>
	  <dojo-checkbox class="ce-layout ce-block" id="dojoDisabledUnCheckedCheckbox" label="Disabled unchecked checkbox"></dojo-checkbox>
	  <dojo-checkbox class="ce-layout ce-block" id="dojoCheckedToggle" mode="toggle" label="Checked Toggle"></dojo-checkbox>
	  <dojo-checkbox class="ce-layout ce-block" id="dojoDisabledCheckedToggle" mode="toggle" label="Disabled checked Toggle"></dojo-checkbox>
	  <dojo-checkbox class="ce-layout ce-block" id="dojoDisabledUnCheckedToggle" mode="toggle" label="Disabled unchecked Toggle"></dojo-checkbox>
	  <dojo-radio class="ce-layout ce-block" id="dojoRadioOne" value="radioGroupOne" label="Radio one"></dojo-radio>
	  <dojo-radio class="ce-layout ce-block" id="dojoRadioTwo" value="radioGroupOne" label="Radio two"></dojo-radio>
	  <dojo-radio class="ce-layout ce-block" id="dojoDisabledUnCheckedRadio" label="Disabled unchecked Radio"></dojo-radio>
	</div>
      </div>

      <vaadin-details id="explanation">
	<div slot="summary"><span id="exstate"></span></div>

	<div id="explainer">
	  <h3>How to use this prototype DOM editor</h3>
	  <p>This DOM editor prompts you in large green text.
	    It will instruct you to choose a tool.
	    Currently, "Copy-insert", "Copy-before", "Move-insert", and "Move-before"
	    are the only tools that work.
	    Clicking on any other tool will produce the message
	    "Unimplemented operation."</p>
	  The program will eventually implement 4 rules for insertions and moves:
	  <ol>
	    <li>Branches of the DOM will be designable as draggable
	      and other branches of the DOM will be designable as not draggable.
	      However, currently just one branch can be designated as draggable
	      at startup. That branch currently comprises the elements
	      in the large gray block.</li>
	    <li>Branches of the DOM will be designable as valid drop targets
		and other branches of the DOM will be designable as not valid
		drop targets.</li>
	    <li>The HTML Content Model places restrictions upon what elements
	      are allowed to be nested inside which other elements.
	      The program will implement rules to enforce these
	      restrcitions.
	      (Refer to the relevant sections of
	      <a href="https://bit.ly/whatwg-content-models">whatwg.org</a>
	      and <a href="https://bit.ly/w3-content-models">w3.org</a>.
	      A good but simple
	      <a href="https://clearlydecoded.com/html-content-models">explanation</a>
	      can be found on ClearlyDecoded.com.)</li>
	    <li>An element cannot be moved into itself, nor into a descendent of itself.
	      For example, if a "Move-insert" operation is attempted
	      and  an element around for awhile then dropped at its original position,
	      the operation is invalid.
	      Likewise, if a "Move-before" operation is attempted and an element
	      is dropped on its own child element or its child's child element,
	      the operation is invalid.
		Invalid operations will produce no change to the DOM structure.</li>
	  </ol>
	  <p>So far, only the 4th rule is implemented. The 1st rule is partially
	    implemented. The demo will be improved as time permits.</p>
	  <p>The <a href="biwascheme.org">BiwaScheme</a> code can be
	    downloaded at <a href="in-browser-gui.scm">in-browser-gui.scm</a>,
	    <a href="browser-util.scm">browser-util.scm</a>, and
	    <a href="mini-framework.scm">mini-framework.scm</a>.
	    There is <a href="index2.html">other experimental code here</a>.
	    This website can be cloned. See
	    <a href="https://github.com/Mashweb/web-call.cc">the project
	      on GitHub</a>.</p>
	  <p>If you like this project or want to see more about it,
	    please visit <a href="Mashweb.Club">Mashweb.Club</a>.</p>
	</div>
      </vaadin-details>
      <script>
	customElements.whenDefined('vaadin-details').then(function() {
	  const details = document.querySelector('#explanation');

	  // listen for details state change
	  details.addEventListener('opened-changed', function(e) {
	    document.getElementById('exstate').textContent = e.detail.value ? 'Hide explanation' : 'Show explanation';
	  });

	  // set the state programmatically
	  details.opened = true;
	});
      </script>

    </vaadin-app-layout>
    <div>
      <script src="js/biwascheme-0.6.9-min.js"></script>
    </div>
    <script src="bundle.js"></script>
    <script async src="widgets/icon-6.0.0.js"></script>
    <script async src="widgets/button-6.0.0.js"></script>
    <script>
      // Buttons

      var popupButton = document.getElementById('dojoEnabledPopupButton');
      var toggleButton = document.getElementById('dojoEnabledToggleButton');
      var disabledBasicButton = document.getElementById('dojoDisabledBasicButton');
      var disabledIconButton = document.getElementById('dojoDisabledIconButton');
      var disabledPopupButton = document.getElementById('dojoDisabledPopupButton');
      var disabledToggleButton = document.getElementById('dojoDisabledToggleButton');

      toggleButton.pressed = true;

      toggleButton.addEventListener('click', function () {
	  toggleButton.pressed = !toggleButton.pressed;
      });
      popupButton.popup = {
	  expanded: false,
	  id: 'dojoPopupButton'
      };

      disabledBasicButton.disabled = true;
      disabledIconButton.disabled = true;
      disabledPopupButton.popup = {
	  expanded: false,
	  id: 'dojoPopupButton'
      };
      disabledPopupButton.disabled = true;
      disabledToggleButton.disabled = true;
      disabledToggleButton.addEventListener('click', function () {
	  disabledToggleButton.pressed = !disabledToggleButton.pressed;
      });

      // Checkbox
      var checkbox = document.getElementById('dojoCheckedCheckbox');
      var disabledCheckedCheckbox = document.getElementById('dojoDisabledCheckedCheckbox');
      var disabledCheckbox = document.getElementById('dojoDisabledUnCheckedCheckbox');

      checkbox.checked = true;
      checkbox.addEventListener('change', function () {
	  checkbox.checked = !checkbox.checked;
      });

      disabledCheckedCheckbox.checked = true;
      disabledCheckedCheckbox.disabled = true;
      disabledCheckbox.disabled = true;

      // Toggle
      var toggle = document.getElementById('dojoCheckedToggle');
      var disabledCheckedToggle = document.getElementById('dojoDisabledCheckedToggle');
      var disabledUnCheckedToggle = document.getElementById('dojoDisabledUnCheckedToggle');

      toggle.checked = true;
      toggle.addEventListener('change', function () {
	  toggle.checked = !toggle.checked;
      });

      disabledCheckedToggle.disabled = true;
      disabledCheckedToggle.checked = true;
      disabledUnCheckedToggle.disabled = true;
      disabledUnCheckedToggle.checked = false;

      // Radio
      var radioOne = document.getElementById('dojoRadioOne');
      var radioTwo = document.getElementById('dojoRadioTwo');
      var disabledRadio = document.getElementById('dojoDisabledUnCheckedRadio');

      radioOne.checked = true;
    </script>
  </body>
</html>
