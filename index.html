<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>web-call.cc</title>
    <style>
      h1.headline { padding: 0.2em; margin-bottom: 0.2em; border-bottom: 1px solid black; }
      div#canvas { padding: 10px; border: 1em solid white; background-color: #a5a096; }
      div#menu { padding-left: 40px; }
      .ex { margin:4px; min-height:20px; padding:10px; border:2px solid blue; }
      .dragged { border:2px solid orange !important; }
      .dragover { border: 2px solid red !important; }
      div.inline { display:inline-flex; }
      ul { margin: 0; padding: 10px 10px 5px 24px; }
      p  { margin-top: 0em; margin-bottom: 0.5em; }
      button { width: 8em; }
      button.ghosted { background-color:#a0a0a0; }
    </style>
    <script src="js/optimal-select.js"></script>
    <script>
      window.addEventListener('DOMContentLoaded', () => {
        var treeWalker;
	treeWalker = document.createTreeWalker($("#canvas")[0], NodeFilter.SHOW_ELEMENT, {
	    acceptNode: function (node) {
		return NodeFilter.FILTER_ACCEPT;
	    }
	}, false);
	//console.log("TreeWalker");
	do {
	    //console.log(treeWalker.currentNode);
	    // Text selections, images, and links have an OS-dependent default rendering
	    // of them being dragged. If we want that default behavior, we should not
	    // set the "draggable" attribute of them.
            treeWalker.currentNode.draggable = "true";
	} while (treeWalker.nextNode());
      });
    </script>
  </head>
  <body>
    <h1 class="headline">web-call.cc demo #1</h1>
    <div>
      <p>This page demonstrates a prototype of the Zen DOM editor.
	It will be improved as time permits.
	The interesting aspect of it is not the tools <em>per se</em>,
	but rather the very clear and simple programming of those tools.
	It does not yet work in Explorer or mobile browsers.</p>
      <p>The program prompts you in large green text.
	It will instruct you to choose a tool.
	Currently, "Copy-insert", "Copy-before", "Move-insert", and "Move-before"
	are the only tools that work.
	Clicking on any other tool will produce the message
	"Unimplemented operation."
        The program will eventually implement 4 rules of insertions and moves:
	<ol>
	  <li>Branches of the DOM can be designated as draggable
	    and other branches of the DOM can be designated not draggable.</li>
	  <li>Branches of the DOM can be designated as valid drop targets
	    and other branches of the DOM can be designated not valid as
	    drop targets.</li>
	  <li>The HTML Content Model places restrictions upon what other elements
	    are allowed to be nested inside which other elements.
	    The program implements rules (so far still incomplete) to enforce these
	    restrcitions.
	    (Refer to the relevant sections of
	    <a href="https://bit.ly/whatwg-content-models">whatwg.org</a>
	    and <a href="https://bit.ly/w3-content-models">w3.org</a>.
	    A good but simple
	    <a href="https://clearlydecoded.com/html-content-models">explanation</a>
	    can be found on ClearlyDecoded.com.)</li>
	  <li>An element cannot be moved into itself, nor into a descendent of itself.
	    For example, if a "Move-insert" operation is attempted
	    and  an element around for awhile then dropped at its original position,
	    the operation is invalid.
	    Likewise, if a "Move-before" operation is attempted and an element
	    is dropped on its own child element or its child's child element,
	    the operation is invalid.
	    Invalid operations will produce no change to the DOM structure.</li>
	</ol>
	So far, only the 4th rule is implemented.
      </p>
      <p>The BiwaScheme code can be
        downloaded at <a href="in-browser-gui.scm">in-browser-gui.scm</a>,
	<a href="browser-util.scm">browser-util.scm</a>, and
	<a href="mini-framework.scm">mini-framework.scm</a>.
	Other experimental code can be found <a href="index2.html">here</a>.</p>
    </div>
    <div>
      <div id="message"></div>
      <div id="error"></div>
    </div>
    <h3>DOM editor tools:</h3>
    <div id="tools">
      <button id="add" class="ghosted">Add-insert</button>
      <button id="copy" style="background-color:lightgreen">Copy-insert</button>
      <button id="copy-before" style="background-color:lightgreen">Copy-before</button>
      <button id="paste" class="ghosted">Paste-insert</button>
      <button id="move" style="background-color:lightgreen">Move-insert</button>
      <button id="move-before" style="background-color:lightgreen">Move-before</button>
      <button id="delete" class="ghosted">Delete</button>
      <button id="undo" class="ghosted">Undo</button>
      <button id="redo" class="ghosted">Redo</button>
      <button id="save" class="ghosted">Save</button>
    </div>
    <div id="canvas" style="overflow: auto;">
      <div class="ex" id="div1">This is DIV 1.<div class="ex" id="div1a">DIV1a</div></div>
      <div class="ex" id="div2">This is DIV 2.</div>
      <div class="ex" id="div3">This is DIV 3.</div>
      <div class="ex" id="div4">This is DIV 4.</div>
      <div class="ex inline" id="idiv1">This is inline DIV 1.</div>
      <div class="ex inline" id="idiv2">This is inline DIV 2.</div>
      <div class="ex inline" id="idiv3">This is inline DIV 3.</div>
      <div class="ex inline" id="idiv4">This is inline DIV 4.</div>
      <hr/>
      <h2>Content Categories</h3>
      <h3>HTML Content Sectioning Tags</h3>
      <address class="ex">This is an address.</address>
      <article class="ex">This is an article.</article>
      <aside class="ex">This is an aside.</aside>
      <footer class="ex">This is a footer.</footer>
      <header class="ex">This is a header.</header>
      <h1 class="ex">This is an H1 section heading.</h1>
      <h2 class="ex">This is an H2 section heading.</h2>
      <h3 class="ex">This is an H3 section heading.</h3>
      <main class="ex">This is a main element.</main>
      <nav class="ex">This is a navigation element.</nav>
      <section class="ex">This is a section.</section>
      <hr/>
      <h2>HTML Text Content Tags</h2>
      <blockquote class="ex">This is a block quotation.</blockquote>
      <dt class="ex">This is a description or definition list.
	<dd>This is a description, definition, or value for the preceding term in a description list.</dd>
	<dd>This is another DD element.</dd>
      </dt>
      <figure>This is a figure.
	<figcaption>This is a figure caption.</figcaption>
      </figure>
      <hr></hr>
      <ol>
	<li>List item 1</li>
	<li>List item 2</li>
	<li>List item 3</li>
      </ol>
      <table>
	<tbody>
	  <tr>
	    <td>1</td>
	    <td>2</td>
	    <td>3</td>
	  </tr>
	  <tr>
	    <td>4</td>
	    <td>5</td>
	    <td>6</td>
	  </tr>
	  <tr>
	    <td>7</td>
	    <td>8</td>
	    <td>9</td>
	  </tr>
	</tbody>
      </table>
    </div>
    <div>
      <script src="js/biwascheme-0.6.9-min.js"></script>
      <script>
	var onError = function(e){ console.error(e); }
	var biwa = new BiwaScheme.Interpreter(onError);
	biwa.evaluate('(load "in-browser-gui.scm") (reset (test))'
		      , function(result) {
			  console.log('BiwaScheme loaded.');
		      });
      </script>
    </div>
  </body>
</html>
